<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile | Book Recommendation</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/styles.css') }}">
</head>
<body>
    <div class="container">
        <h1>Book Recommendation API</h1>
        <h2 style='text-align:center'>Welcome, {{ user.username }}</h2>

        <div class="profile-info">
            <h3>Profile Information</h3>
            <p><strong>Username:</strong> {{ user.username }}</p>
            <p><strong>User ID:</strong> {{ user.id }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p><strong>Age:</strong> {{ user.age }}</p>
            <p><strong>Country:</strong> {{ user.country }}</p>
            <h4>Your Favorite Subjects</h3>
            {% if user.favorite_subjects %}
                <div class="subject-list">
                    {% for subj in user.favorite_subjects %}
                        <div class="subject-pill">{{ subj }}</div>
                    {% endfor %}
                </div>
            {% else %}
                <p style="color: #555; font-style: italic;">You haven't selected any favorite subjects yet.</p>
            {% endif %}

        </div>

        <h3>Personalised Recommendations</h3>
        <button id="recommendButton">Get Recommendations</button>
        <div id="recommendations" style="display: none"></div>
        <div style="text-align: center; margin-top: 10px;">
            <button id="prevButton" style="display: none; width: auto;">Previous</button>
            <button id="nextButton" style="display: none; width: auto;">Next</button>
        </div>
    </div>

    <script type="module">
        import { setupPaginatedBookDisplay } from "/static/js/paginated_books.js";

        document.getElementById('recommendButton').onclick = async () => {
            const res = await fetch(`/profile/recommend?user={{ user.id }}&top_n=100`);
            const data = await res.json();

            if (res.ok) {
                setupPaginatedBookDisplay({
                    books: data,
                    containerId: "recommendations",
                    prevButtonId: "prevButton",
                    nextButtonId: "nextButton",
                    scrollOnFirstRender: true,
                    limit: 30,
                });
                document.getElementById("recommendButton").style.display = "none";
            } else {
                document.getElementById("recommendations").innerHTML = `<p style="color:red">Error: ${data.detail}</p>`;
                document.getElementById("recommendations").style.display = "block";
            }
        };
    </script>

</body>
</html>
